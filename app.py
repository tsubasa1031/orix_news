import streamlit as st
import pandas as pd

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(
    page_title="ã‚ªãƒªãƒƒã‚¯ã‚¹ãƒ»ãƒãƒ•ã‚¡ãƒ­ãƒ¼ã‚º ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¾ã¨ã‚",
    page_icon="âš¾",
    layout="wide"
)

# --- 1. ãƒ‡ãƒ¼ã‚¿æº–å‚™ï¼ˆæœ¬æ¥ã¯ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚„APIã§å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã™ï¼‰ ---
def load_data():
    # å…ˆã»ã©ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹è¦ç´„ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ åŒ–
    data = [
        {"date": "2025-11-26", "category": "å¥‘ç´„æ›´æ”¹", "title": "å±±å´é¢¯ä¸€éƒ æŠ•æ‰‹", "summary": "15%ãƒ€ã‚¦ãƒ³ã®4,500ä¸‡å††ã§æ›´æ”¹ã€‚æ¥å­£ã¯ã€Œ7ã€8ã€9å›ã€ã®å‹ã¡ãƒ‘ã‚¿ãƒ¼ãƒ³å¾©å¸°ã‚’ç›®æŒ‡ã™ã€‚", "tags": ["æŠ•æ‰‹", "æ¸›é¡"]},
        {"date": "2025-11-26", "category": "å¥‘ç´„æ›´æ”¹", "title": "æ± æ™ƒå¹³ æŠ•æ‰‹", "summary": "500ä¸‡å††ãƒ€ã‚¦ãƒ³ã®1,900ä¸‡å††ã§æ›´æ”¹ã€‚æ€ªæˆ‘ã®å½±éŸ¿ã‚’åçœã—ã€å¹´é–“ã‚’é€šã—ãŸæ´»èºã‚’èª“ã†ã€‚", "tags": ["æŠ•æ‰‹", "æ¸›é¡"]},
        {"date": "2025-11-25", "category": "å¥‘ç´„æ›´æ”¹", "title": "å±±ä¸‹èˆœå¹³å¤§ æŠ•æ‰‹", "summary": "600ä¸‡å††ãƒ€ã‚¦ãƒ³ã®3,000ä¸‡å††ã§æ›´æ”¹ã€‚è…°ã®æ€ªæˆ‘ã§ã®å‡ºé…ã‚Œã‚’å–ã‚Šæˆ»ã™ã¹ãæ¥å­£ã¸æ„æ¬²ã€‚", "tags": ["æŠ•æ‰‹", "æ¸›é¡"]},
        {"date": "2025-11-24", "category": "çƒå›£æƒ…å ±", "title": "æ–°ãƒ­ã‚´ãƒ»ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒ ç™ºè¡¨", "summary": "2026å¹´ã«å‘ã‘ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¼ãƒãƒ¼ã‚¯ã‚’ä¸€æ–°ã€‚ãƒã‚¤ãƒ“ãƒ¼ã¨ã‚´ãƒ¼ãƒ«ãƒ‰ã‚’åŸºèª¿ã¨ã—ãŸæ´—ç·´ã•ã‚ŒãŸãƒ‡ã‚¶ã‚¤ãƒ³ã¸ã€‚", "tags": ["ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒ ", "ãƒªãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°"]},
        {"date": "2025-11-23", "category": "æ–°æˆ¦åŠ›", "title": "æ–°å¤–å›½äºº2é¸æ‰‹ç²å¾—", "summary": "ã‚¸ãƒ§ãƒ¼ãƒ€ãƒ³ãƒ»ãƒ‡ã‚£ã‚¢ã‚¹å†…é‡æ‰‹ã€ã‚¨ãƒ‰ãƒ¯ãƒ¼ãƒ‰ãƒ»ã‚ªãƒªãƒãƒ¬ã‚¹å¤–é‡æ‰‹ã‚’ç²å¾—ã—ã€æ‰“ç·šå¼·åŒ–ã‚’å›³ã‚‹ã€‚", "tags": ["è£œå¼·", "å¤–å›½äººé¸æ‰‹"]},
        {"date": "2025-11-22", "category": "ãƒ“ã‚¸ãƒã‚¹", "title": "ãƒãƒ³ã‚¿å¥‘ç´„æ›´æ–°", "summary": "ãƒ­ã‚¤ãƒ¤ãƒªãƒ†ã‚£ ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ç¤¾ã¨ã®ã‚¹ãƒãƒ³ã‚µãƒ¼å¥‘ç´„ã‚’æ›´æ–°ã€‚æ¥å­£ã¯ãƒãƒ•ã‚¡ãƒ­ãƒ¼ã‚ºâ˜†ãƒãƒ³ã‚¿10å‘¨å¹´ã€‚", "tags": ["ã‚¹ãƒãƒ³ã‚µãƒ¼", "ãƒãƒ³ã‚¿"]},
    ]
    return pd.DataFrame(data)

df = load_data()

# --- 2. ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ï¼‰ ---
st.sidebar.title("ğŸ” æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼")

# ã‚«ãƒ†ã‚´ãƒªé¸æŠ
categories = df["category"].unique()
selected_categories = st.sidebar.multiselect(
    "ã‚«ãƒ†ã‚´ãƒªã§çµã‚Šè¾¼ã¿",
    categories,
    default=categories
)

# ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢
search_query = st.sidebar.text_input("ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ï¼ˆä¾‹: æŠ•æ‰‹, ãƒãƒ³ã‚¿ï¼‰")

# ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å®Ÿè¡Œ
filtered_df = df[df["category"].isin(selected_categories)]

if search_query:
    # ã‚¿ã‚¤ãƒˆãƒ«ã‹è¦ç´„ã«ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’æŠ½å‡º
    filtered_df = filtered_df[
        filtered_df["title"].str.contains(search_query) | 
        filtered_df["summary"].str.contains(search_query)
    ]

# --- 3. ãƒ¡ã‚¤ãƒ³ç”»é¢ ---
st.title("âš¾ ã‚ªãƒªãƒƒã‚¯ã‚¹ãƒ»ãƒãƒ•ã‚¡ãƒ­ãƒ¼ã‚º News Aggregator")
st.markdown(f"æœ€æ–°ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ **{len(filtered_df)}** ä»¶ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚")

# è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆ
view_mode = st.radio("è¡¨ç¤ºå½¢å¼:", ["ã‚«ãƒ¼ãƒ‰è¡¨ç¤º", "ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«"], horizontal=True)

st.divider()

if view_mode == "ã‚«ãƒ¼ãƒ‰è¡¨ç¤º":
    # ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’ã‚«ãƒ¼ãƒ‰ï¼ˆExpanderï¼‰ã§è¡¨ç¤º
    for index, row in filtered_df.iterrows():
        # ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«è‰²ã‚’å¤‰ãˆã‚‹ãƒãƒƒã‚¸ã®ã‚ˆã†ãªè¡¨ç¤º
        cat_color = "blue" if row['category'] == "å¥‘ç´„æ›´æ”¹" else "green" if row['category'] == "çƒå›£æƒ…å ±" else "orange"
        
        with st.expander(f"ã€{row['category']}ã€‘ {row['title']} ({row['date']})", expanded=True):
            st.markdown(f"### {row['title']}")
            st.info(row['summary'])
            st.caption(f"ã‚¿ã‚°: {', '.join(row['tags'])}")
            
elif view_mode == "ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«":
    # ä¸€è¦§æ€§ãŒé«˜ã„ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º
    st.dataframe(
        filtered_df,
        column_config={
            "date": "æ—¥ä»˜",
            "category": "ã‚«ãƒ†ã‚´ãƒª",
            "title": "è¦‹å‡ºã—",
            "summary": "ãƒ‹ãƒ¥ãƒ¼ã‚¹è¦ç´„",
            "tags": "ã‚¿ã‚°"
        },
        use_container_width=True,
        hide_index=True
    )

# --- 4. ãƒ•ãƒƒã‚¿ãƒ¼ ---
st.markdown("---")
st.caption("Data Source: News Aggregation (Demo)")
